/*! e50-charts 2016-02-26 */
angular.module("E50Charts",[]),angular.module("E50Charts").directive("e50Chart",["$timeout","E50ChartFactory","$rootScope",function(a,b,c){var d=['<div class="e50-charts">','<div class="chart"></div>',"</div>"];return{scope:{data:"=",xaxis:"=?",yaxis:"=?",chart:"@",override:"=?"},template:d.join(""),link:function(d,e){var f=$("body");e.find(".chart").hover(function(){f.css("overflow","hidden")},function(){a(function(){f.css("overflow","auto")},200)});var g=b.newInstance();g.setElement(e),g.setScope(d),g.setData(d.data),d.xaxis&&(g.enableXAxis(d.xaxis.columns),d.xaxis.isTimeseries&&g.enableTimeseries(d.xaxis.dateFormat,d.xaxis.tickFormat,d.xaxis.tickCount)),d.yaxis&&(g.config.axis.y=d.yaxis),g.generate(d.override),d.chartTypes=g.chartTypes;var h=angular.copy(g.dataIds);h.unshift("All"),d.dataIds=h,d.dataId="All",d.executeTransform=g.executeTransform.bind(g),d.stack=g.stack.bind(g),d.unstack=g.unstack.bind(g),d.chart&&c.$broadcast(d.chart,g)}}}]),angular.module("E50Charts").factory("E50Chart",["E50ChartConfig",function(a){function b(){this.main.append("rect").style("fill",a.overlayColor).attr("x",.5).attr("y",-.5).attr("width",this.width).attr("height",this.height).transition().duration(1500).attr("x",this.width).attr("width",0).remove()}function c(){this.chart=null,this.chartSelector=".chart",this.element=null,this.dataChartTypes={},this.chartElm=null,this.dataIds=[],this.allChartTypes={pie:"Pie",donut:"Donut",bar:"Bar",step:"Step","area-step":"Area Step",line:"Line",area:"Area",spline:"Spline","area-spline":"Area Spline",scatter:"Scatter"},this.chartTypes=a.chartTypes||this.allChartTypes,this.config={data:{columns:[],types:{}},axis:{y:{tick:{format:d3.format(",")}}},tooltip:{show:!0},bar:{width:{ratio:.5}},pie:{expand:!1},donut:{expand:!1},color:{pattern:["#00aeef","#faa83b","#3ab87a","#f04e2e","#0178a3","#0f6163","#dcc828","#00a3ec","#512a79","#92d3c9","#df2770","#c8dc4a","#015e80"]},onresized:function(){b.call(this),c.adjustLegend.call(this)},oninit:function(){b.call(this),c.adjustLegend.call(this)}}}return c.adjustLegend=function(){var a=angular.element(this.svg[0][0]).find("> g");if(!(a.length<3)){var b=a[2];setTimeout(function(){var c=Math.ceil(a[0].getBBox().height)+2;b.setAttribute("transform","translate(0, "+c+")")},50)}},c.prototype.setElement=function(a){this.element=a},c.prototype.setScope=function(a){this.scope=a},c.prototype.setData=function(a){var b=this;angular.forEach(a,function(a,c){if(-1===b.dataIds.indexOf(c)){b.dataIds.push(c);var d=angular.copy(a.columns);d.unshift(c),b.config.data.columns.push(d),b.config.data.types[c]=a.type}})},c.prototype.load=function(a){this.setData(a),this.chart.load(this.config.data)},c.prototype.unload=function(a){this.chart.unload(a)},c.prototype.enableXAxis=function(a){if(a){a=angular.copy(a);var b=a.x;b.unshift("x"),this.config.data.columns.unshift(b)}this.config.data.x="x",this.config.axis.x={type:"category"}},c.prototype.enableTimeseries=function(a,b,c){a&&(this.config.data.xFormat=a),this.config.axis.x={type:"timeseries",tick:{format:b||a,count:c}}},c.prototype.generate=function(a){angular.extend(this.config,a),this.chartElm=this.element.find(this.chartSelector)[0],this.config.bindto=this.chartElm,this.chart=c3.generate(this.config)},c.prototype.transform=function(a,b){return-1===this.dataIds.indexOf(b)?!1:void this.chart.transform(a,b)},c.prototype.executeTransform=function(a,b){var c="all"!==b.toLowerCase()||!b,d=c?"transform":"transformAll";return a?("pie"!==a&&"donut"!==a||(d="transformAll"),void this[d](a,b)):void alert("Please select a chart type to transform the data")},c.prototype.transformAll=function(a){this.chart.transform(a,this.dataIds)},c.prototype.show=function(a){this.chart.show(a)},c.prototype.hide=function(a){this.chart.hide(a)},c.prototype.toggle=function(a){this.chart.toggle(a)},c.prototype.focus=function(a){this.chart.focus(a)},c.prototype.defocus=function(a){this.chart.defocus(a)},c.prototype.stack=function(){this.chart.groups([this.dataIds])},c.prototype.unstack=function(){var a=[];angular.forEach(this.dataIds,function(b){a.push([b])}),this.chart.groups(a)},c}]),angular.module("E50Charts").factory("E50ChartConfig",function(){return{overlayColor:"#ffffff",chartTypes:{pie:"Pie",donut:"Donut",bar:"Bar",step:"Step","area-step":"Area Step",line:"Line",area:"Area",spline:"Spline","area-spline":"Area Spline",scatter:"Scatter"}}}),angular.module("E50Charts").factory("E50ChartFactory",["E50Chart",function(a){return{newInstance:function(){return new a}}}]);